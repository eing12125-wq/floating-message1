<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Merry Christmas & Happy New Year</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Mountains+of+Christmas&display=swap');

body {
  margin: 0;
  font-family: 'Mountains of Christmas', cursive, Arial, sans-serif;
  /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏ó‡∏ô‡πÅ‡∏î‡∏á‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡πå‡∏°‡∏≤‡∏™ */
  background: linear-gradient(135deg, #8b0000 0%, #b22222 25%, #dc143c 50%, #ff4500 75%, #8b0000 100%);
  background-size: 400% 400%;
  animation: christmasGradient 15s ease infinite;
  background-attachment: fixed;
  position: relative;
  overflow: hidden;
  color: white;
  /* GPU acceleration */
  transform: translateZ(0);
  will-change: auto;
}

@keyframes christmasGradient {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.3);
  z-index: 0;
  pointer-events: none;
  /* GPU acceleration */
  transform: translateZ(0);
}

@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà - ‡πÇ‡∏ó‡∏ô‡πÅ‡∏î‡∏á‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡πå‡∏°‡∏≤‡∏™ */
#header {
  position: fixed;
  top: 15px;
  width: 100%;
  text-align: center;
  font-size: 3.5rem;
  font-weight: 700;
  text-shadow: 
    0 0 10px #fff,
    0 0 20px #ffd700,
    0 0 30px #ff0000,
    0 0 40px #dc143c,
    0 0 50px #8b0000;
  letter-spacing: 3px;
  z-index: 1000;
  user-select: none;
  transform: translateZ(0);
  will-change: transform;
  line-height: 1.3;
  animation: glowPulse 2s ease-in-out infinite alternate;
}

@keyframes glowPulse {
  from {
    text-shadow: 
      0 0 10px #fff,
      0 0 20px #ffd700,
      0 0 30px #ff0000,
      0 0 40px #dc143c;
  }
  to {
    text-shadow: 
      0 0 15px #fff,
      0 0 30px #ffd700,
      0 0 45px #ff4500,
      0 0 60px #dc143c,
      0 0 75px #8b0000;
  }
}

/* ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏≠‡∏¢ */
#scene {
  position: relative;
  width: 100vw;
  height: 100vh;
  z-index: 1;
}

.message {
  position: absolute;
  padding: 0.8em 1.5em;
  background: linear-gradient(135deg, 
    rgba(255,255,255,0.98) 0%, 
    rgba(255,245,245,0.98) 50%,
    rgba(255,235,235,0.98) 100%);
  border-radius: 2em;
  white-space: nowrap;
  animation: float 18s linear infinite;
  box-shadow: 
    0 5px 20px rgba(139,0,0,0.6),
    0 0 30px rgba(220,20,60,0.4),
    inset 0 2px 0 rgba(255,255,255,0.8),
    inset 0 -3px 10px rgba(220,20,60,0.3);
  font-size: clamp(14px, 4vw, 20px);
  color: #8b0000;
  font-weight: 700;
  border: 3px solid;
  border-image: linear-gradient(90deg, #dc143c, #ffd700, #228b22, #ffd700, #dc143c) 1;
  transform: translateZ(0);
  will-change: transform;
  filter: drop-shadow(0 0 10px rgba(255,215,0,0.5));
  text-shadow: 0 1px 3px rgba(139,0,0,0.3);
  position: relative;
}

/* ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
.message::before {
  content: 'üéÑ';
  position: absolute;
  left: -25px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1.2em;
}

.message::after {
  content: 'üéÅ';
  position: absolute;
  right: -25px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1.2em;
}

@keyframes float {
  from { transform: translate3d(110vw, 0, 0); }
  to { transform: translate3d(-120%, 0, 0); }
}

/* ‡πÅ‡∏ñ‡∏ö input - ‡∏ò‡∏µ‡∏°‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡πå‡∏°‡∏≤‡∏™‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å (‡∏Å‡∏∞‡∏ó‡∏±‡∏î‡∏£‡∏±‡∏î) */
#control {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%) translateZ(0);
  background: linear-gradient(135deg, 
    rgba(255,255,255,0.98) 0%, 
    rgba(255,240,240,0.98) 50%, 
    rgba(255,250,250,0.98) 100%);
  padding: 1em 1.5em;
  border-radius: 2.5em;
  display: flex;
  gap: 0.6em;
  align-items: center;
  flex-wrap: wrap;
  z-index: 1001;
  max-width: 90vw;
  box-shadow: 
    0 10px 40px rgba(139,0,0,0.6),
    0 0 60px rgba(255,215,0,0.4),
    inset 0 2px 0 rgba(255,255,255,0.5),
    inset 0 -3px 10px rgba(220,20,60,0.2);
  border: 4px solid;
  border-image: linear-gradient(45deg, 
    #dc143c 0%, 
    #ffd700 25%, 
    #228b22 50%, 
    #ffd700 75%, 
    #dc143c 100%) 1;
  will-change: transform;
  position: relative;
  animation: controlGlow 3s ease-in-out infinite alternate;
}

@keyframes controlGlow {
  0% { 
    box-shadow: 
      0 10px 40px rgba(139,0,0,0.6),
      0 0 60px rgba(255,215,0,0.4),
      inset 0 2px 0 rgba(255,255,255,0.5);
  }
  100% { 
    box-shadow: 
      0 10px 40px rgba(139,0,0,0.8),
      0 0 80px rgba(255,215,0,0.6),
      inset 0 2px 0 rgba(255,255,255,0.7);
  }
}

/* ‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏£‡∏≠‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á */
#control::before {
  content: 'üéÑ';
  position: absolute;
  left: -28px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1.5em;
  animation: treeSwing 2s ease-in-out infinite;
}

#control::after {
  content: 'üéÖ';
  position: absolute;
  right: -28px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1.5em;
  animation: santaWave 2s ease-in-out infinite;
}

@keyframes treeSwing {
  0%, 100% { transform: translateY(-50%) rotate(0deg); }
  50% { transform: translateY(-50%) rotate(10deg); }
}

@keyframes santaWave {
  0%, 100% { transform: translateY(-50%) scale(1); }
  50% { transform: translateY(-50%) scale(1.1); }
}

/* ‡∏î‡∏≤‡∏ß‡∏£‡∏≠‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á */
.control-star {
  position: absolute;
  font-size: 1em;
  animation: starRotate 4s linear infinite;
  pointer-events: none;
}

@keyframes starRotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

input {
  flex: 1 1 180px;
  min-width: 180px;
  max-width: 350px;
  padding: 0.7em 1em;
  font-size: 0.95em;
  border: 3px solid;
  border-image: linear-gradient(90deg, #dc143c, #ffd700, #228b22) 1;
  border-radius: 1.3em;
  outline: none;
  background: linear-gradient(135deg, 
    rgba(255,255,255,0.98) 0%, 
    rgba(255,250,245,0.98) 100%);
  color: #8b0000;
  font-weight: 600;
  box-shadow: 
    inset 0 3px 8px rgba(139,0,0,0.1),
    0 2px 10px rgba(255,215,0,0.3);
  font-family: 'Mountains of Christmas', cursive, Arial, sans-serif;
  transition: all 0.3s ease;
  position: relative;
}

input::placeholder {
  color: #dc143c;
  opacity: 0.6;
  font-weight: 500;
  font-size: 0.95em;
}

input:focus {
  box-shadow: 
    0 0 20px 5px rgba(255,215,0,0.5),
    0 0 30px rgba(220,20,60,0.4),
    inset 0 3px 8px rgba(139,0,0,0.1);
  border-image: linear-gradient(90deg, #ffd700, #ff4500, #ffd700) 1;
  transform: scale(1.02);
}

button {
  padding: 0.7em 1.3em;
  font-size: 0.95em;
  flex: 0 0 auto;
  border-radius: 1.3em;
  cursor: pointer;
  background: linear-gradient(135deg, #8b0000 0%, #dc143c 50%, #ff4500 100%);
  color: white;
  border: 3px solid #ffd700;
  font-weight: 700;
  box-shadow: 
    0 5px 20px rgba(139,0,0,0.6),
    0 0 30px rgba(255,215,0,0.4),
    inset 0 2px 0 rgba(255,255,255,0.3),
    inset 0 -2px 5px rgba(0,0,0,0.2);
  transition: all 0.3s ease;
  text-shadow: 0 2px 4px rgba(0,0,0,0.4);
  font-family: 'Mountains of Christmas', cursive, Arial, sans-serif;
  position: relative;
  overflow: hidden;
  white-space: nowrap;
}

button::before {
  content: '';
  display: none;
}

button::after {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(
    45deg,
    transparent,
    rgba(255,255,255,0.1),
    transparent
  );
  transform: rotate(45deg);
  animation: buttonShine 3s ease-in-out infinite;
}

@keyframes buttonShine {
  0%, 100% { transform: translateX(-100%) rotate(45deg); }
  50% { transform: translateX(100%) rotate(45deg); }
}

button:hover {
  background: linear-gradient(135deg, #dc143c 0%, #ff4500 50%, #ffd700 100%);
  transform: translateY(-3px) scale(1.05);
  box-shadow: 
    0 8px 25px rgba(139,0,0,0.8),
    0 0 40px rgba(255,215,0,0.6),
    inset 0 2px 0 rgba(255,255,255,0.5);
  border-color: #fff;
}

button:active {
  transform: translateY(-1px) scale(1.02);
}

/* ‡∏õ‡∏£‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
@media screen and (max-width: 600px) {
  #header {
    font-size: 2rem;
    top: 10px;
    padding: 0 10px;
  }
  
  #control {
    padding: 1.2em 1.5em;
    border-width: 3px;
  }
  
  #control::before,
  #control::after {
    display: none;
  }
  
  input {
    font-size: 0.95em;
    padding: 0.8em 1.2em;
  }
  
  button {
    font-size: 0.95em;
    padding: 0.8em 1.5em;
  }
  
  button::before {
    font-size: 1em;
  }
  
  .message::before,
  .message::after {
    font-size: 1em;
    left: -20px;
    right: -20px;
  }
  
  .christmas-light {
    display: none;
  }
  
  .control-star {
    font-size: 1em;
  }
}

/* ‡∏´‡∏¥‡∏°‡∏∞ */
.snowflake {
  position: fixed;
  top: -10px;
  background: white;
  border-radius: 50%;
  opacity: 0.9;
  filter: drop-shadow(0 0 3px white);
  animation: snowfall linear infinite;
  pointer-events: none;
  z-index: 999;
}

@keyframes snowfall {
  0% { 
    transform: translateY(-10px) translateX(0) rotate(0deg);
    opacity: 0.9;
  }
  100% { 
    transform: translateY(110vh) translateX(50px) rotate(360deg);
    opacity: 0.3;
  }
}

/* ‡∏î‡∏≤‡∏ß */
.star {
  position: fixed;
  background: #ffd700;
  clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
  opacity: 0.9;
  animation: starTwinkle 2s ease-in-out infinite alternate;
  pointer-events: none;
  z-index: 998;
  filter: drop-shadow(0 0 5px gold);
}

@keyframes starTwinkle {
  from { opacity: 0.9; transform: scale(1) rotate(0deg); }
  to { opacity: 0.3; transform: scale(0.7) rotate(45deg); }
}

/* ‡∏û‡∏•‡∏∏/‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡πÑ‡∏ü */
.firework {
  position: fixed;
  width: 4px;
  height: 4px;
  border-radius: 50%;
  pointer-events: none;
  z-index: 997;
  animation: explode 2s ease-out forwards;
}

@keyframes explode {
  0% {
    transform: translate(0, 0) scale(1);
    opacity: 1;
  }
  100% {
    transform: translate(var(--tx), var(--ty)) scale(0);
    opacity: 0;
  }
}

/* ‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏ï‡∏ï‡∏µ‡πâ */
.confetti {
  position: fixed;
  width: 10px;
  height: 10px;
  pointer-events: none;
  z-index: 996;
  animation: confettiFall 4s linear infinite;
  top: -20px;
}

@keyframes confettiFall {
  0% {
    transform: translateY(-20px) rotate(0deg);
    opacity: 1;
  }
  100% {
    transform: translateY(110vh) rotate(720deg);
    opacity: 0;
  }
}

/* ‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç - ‡πÇ‡∏ó‡∏ô‡πÅ‡∏î‡∏á‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡πå‡∏°‡∏≤‡∏™ */
.gift {
  position: fixed;
  width: 30px;
  height: 30px;
  background: linear-gradient(135deg, #8b0000 0%, #dc143c 100%);
  border: 3px solid #ffd700;
  border-radius: 6px;
  animation: giftFall 8s linear infinite;
  pointer-events: none;
  z-index: 995;
  box-shadow: 
    0 0 15px rgba(220,20,60,0.8),
    inset 0 2px 5px rgba(255,255,255,0.2);
}

@keyframes giftFall {
  0% {
    transform: translateY(-50px) rotate(0deg);
    opacity: 1;
  }
  100% {
    transform: translateY(110vh) rotate(360deg);
    opacity: 0.5;
  }
}

/* ‡∏£‡∏∞‡∏Ü‡∏±‡∏á */
.bell {
  position: fixed;
  width: 25px;
  height: 25px;
  background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
  border-radius: 0 0 50% 50%;
  box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
  animation: bellSwing 3s ease-in-out infinite;
  pointer-events: none;
  z-index: 994;
}

@keyframes bellSwing {
  0%, 100% { transform: rotate(0deg); }
  25% { transform: rotate(15deg); }
  75% { transform: rotate(-15deg); }
}

/* Sparkles */
.sparkle {
  position: fixed;
  width: 6px;
  height: 6px;
  background: white;
  border-radius: 50%;
  animation: sparkleAnim 1.5s ease-in-out infinite;
  pointer-events: none;
  box-shadow: 0 0 10px 3px rgba(255, 255, 255, 0.8);
  z-index: 993;
}

@keyframes sparkleAnim {
  0%, 100% { 
    opacity: 0; 
    transform: scale(0) rotate(0deg);
  }
  50% { 
    opacity: 1; 
    transform: scale(1.5) rotate(180deg);
  }
}

/* ‡∏ï‡πâ‡∏ô‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡πå‡∏°‡∏≤‡∏™ */
.christmas-tree {
  position: fixed;
  bottom: 0;
  width: 50px;
  height: 70px;
  pointer-events: none;
  z-index: 992;
}

.tree-top {
  width: 0;
  height: 0;
  border-left: 25px solid transparent;
  border-right: 25px solid transparent;
  border-bottom: 40px solid #228b22;
  position: absolute;
  bottom: 30px;
  filter: drop-shadow(0 0 8px rgba(34,139,34,0.6));
}

.tree-middle {
  width: 0;
  height: 0;
  border-left: 22px solid transparent;
  border-right: 22px solid transparent;
  border-bottom: 35px solid #2d7a2d;
  position: absolute;
  bottom: 20px;
  left: 3px;
}

.tree-trunk {
  width: 12px;
  height: 20px;
  background: #654321;
  position: absolute;
  bottom: 0;
  left: 19px;
  border-radius: 2px;
}

.tree-star {
  position: absolute;
  top: -8px;
  left: 20px;
  width: 10px;
  height: 10px;
  background: #ffd700;
  clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
  animation: starGlow 1s ease-in-out infinite alternate;
  filter: drop-shadow(0 0 5px gold);
}

@keyframes starGlow {
  from { opacity: 1; transform: scale(1); }
  to { opacity: 0.6; transform: scale(1.2); }
}
</style>
</head>
<body>

<div id="header">
  <div style="font-size: 1em; margin-bottom: 0.1em; letter-spacing: 2px;">ü¶â AI Event : AI wishes with OWL ü¶â</div>
  <div style="font-size: 0.65em; letter-spacing: 1px;">üéÑ Merry Christmas & Happy New Year üéâ</div>
</div>
<div id="scene"></div>

<div id="control">
  <input id="textInput" placeholder="üéÖ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏≤‡∏£‡∏ñ‡∏ô‡∏≤" maxlength="40" onkeypress="if(event.key==='Enter') addMessage()">
  <button onclick="addMessage()">üéÅ ‡∏™‡πà‡∏á</button>
</div>

<script type="module">
// Import Firebase
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getDatabase, ref, push, onChildAdded, remove, query, orderByChild, limitToLast } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

// Firebase Configuration - ‡πÉ‡∏™‡πà Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß ‚úÖ
const firebaseConfig = {
  apiKey: "AIzaSyAQYcOm2dr_KiIpGki_FXhw4IFWdx2QKpU",
  authDomain: "christmas-message-6d84c.firebaseapp.com",
  databaseURL: "https://christmas-message-6d84c-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "christmas-message-6d84c",
  storageBucket: "christmas-message-6d84c.firebasestorage.app",
  messagingSenderId: "264739189920",
  appId: "1:264739189920:web:e0e9707825e8434d3905c5",
  measurementId: "G-JC8514H8FP"
};

// Initialize Firebase
let app, database, messagesRef, messagesQuery;

try {
  app = initializeApp(firebaseConfig);
  database = getDatabase(app);
  messagesRef = ref(database, 'messages');
  
  // Query ‡πÅ‡∏Ñ‡πà 50 ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
  messagesQuery = query(messagesRef, orderByChild('timestamp'), limitToLast(50));
  
  console.log('üî• Firebase ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
  console.log('üìä Database URL:', firebaseConfig.databaseURL);
  console.log('üìù ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏Ñ‡πà 50 ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î');
} catch (error) {
  console.error('‚ùå Firebase initialization error:', error);
  alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase: ' + error.message);
}

// ‡∏Ñ‡∏≥‡∏´‡∏¢‡∏≤‡∏ö (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ + ‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)
const bannedWords = [
  // ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
  '‡∏Ñ‡∏ß‡∏¢', '‡∏´‡∏µ', '‡πÅ‡∏ï‡∏î', '‡πÄ‡∏´‡∏µ‡πâ‡∏¢', '‡∏™‡∏±‡∏™', '‡πÄ‡∏ä‡∏µ‡πâ‡∏¢', '‡∏´‡∏£‡∏£‡∏°', '‡∏Å‡∏µ', '‡∏õ‡∏µ‡πä', 
  '‡πÄ‡∏¢‡∏î', '‡πÄ‡∏¢‡πá‡∏î', '‡πÄ‡∏î‡πâ‡∏≤', '‡∏ô‡∏°', '‡∏à‡∏π‡πã', '‡∏à‡∏¥‡πã‡∏°',
  // ‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©
  'hee', 'kuy', 'tad', 'yed', 'hum', 'shit', 'fuck', 'sus',
  // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏•‡∏ö
  'khuay', 'heee', 'kuyyy', 'sh1t', 'fck', 'fuk'
];

function filterBadWords(text) {
  let filtered = text;
  bannedWords.forEach(word => {
    const re = new RegExp(word, 'gi');
    filtered = filtered.replace(re, '***');
  });
  return filtered;
}

// ‡∏ü‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å Firebase (‡πÅ‡∏Ñ‡πà 50 ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
const messageElements = []; // ‡πÄ‡∏Å‡πá‡∏ö reference ‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á
const MAX_MESSAGES = 50;

if (messagesQuery) {
  onChildAdded(messagesQuery, (snapshot) => {
    const msg = snapshot.val().text;
    const messageEl = addMessageToScene(msg);
    messageElements.push(messageEl);
    
    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô 50 ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏≠‡∏≠‡∏Å
    if (messageElements.length > MAX_MESSAGES) {
      const oldestMessage = messageElements.shift();
      if (oldestMessage && oldestMessage.parentNode) {
        oldestMessage.remove();
      }
    }
    
    console.log('üì© ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°:', msg, `(${messageElements.length}/${MAX_MESSAGES})`);
  }, (error) => {
    console.error("‚ùå Error loading messages:", error);
    console.error("Error code:", error.code);
    console.error("Error message:", error.message);
    
    // ‡πÅ‡∏™‡∏î‡∏á error ‡∏ó‡∏µ‡πà‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á
    if (error.code === 'PERMISSION_DENIED') {
      alert("‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Firebase!\n\n‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Firebase Console ‚Üí Realtime Database ‚Üí Rules\n‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô .read ‡πÅ‡∏•‡∏∞ .write ‡πÄ‡∏õ‡πá‡∏ô true");
    } else {
      alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase ‡πÑ‡∏î‡πâ\nError: " + error.message);
    }
  });
} else {
  console.error('‚ùå messagesQuery is undefined');
  alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á Firebase query ‡πÑ‡∏î‡πâ');
}

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà (‡∏°‡∏µ rate limiting ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô spam)
let lastMessageTime = 0;
const MESSAGE_COOLDOWN = 1000; // 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

window.addMessage = function() {
  const input = document.getElementById("textInput");
  let msg = input.value.trim();
  if (!msg) return;

  // Rate limiting
  const now = Date.now();
  if (now - lastMessageTime < MESSAGE_COOLDOWN) {
    console.log('‚è≥ ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
    return;
  }
  lastMessageTime = now;

  if (!messagesRef) {
    alert('‚ùå Firebase ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
    return;
  }

  msg = filterBadWords(msg);
  
  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Firebase
  push(messagesRef, {
    text: msg,
    timestamp: Date.now()
  }).then(() => {
    console.log('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', msg);
  }).catch((error) => {
    console.error('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ:', error);
    console.error('Error code:', error.code);
    
    if (error.code === 'PERMISSION_DENIED') {
      alert('‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•!\n\n‡πÑ‡∏õ‡∏ó‡∏µ‡πà Firebase Console ‚Üí Rules\n‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô .write ‡πÄ‡∏õ‡πá‡∏ô true');
    } else {
      alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: ' + error.message);
    }
  });

  input.value = "";
}

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏á scene
function addMessageToScene(msg) {
  const div = document.createElement("div");
  div.className = "message";
  div.textContent = msg;
  // ‡∏•‡∏≠‡∏¢‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ 2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà 35vh (‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠) ‡∏ñ‡∏∂‡∏á 85vh
  div.style.top = (Math.random() * 50 + 35) + "vh";
  div.style.animationDuration = (12 + Math.random() * 12) + "s";
  document.getElementById("scene").appendChild(div);
  return div; // return element ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö reference
}

// ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
window.clearMessages = function() {
  if (!messagesRef) {
    alert('‚ùå Firebase ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
    return;
  }

  if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°? (‡∏à‡∏∞‡∏•‡∏ö‡∏à‡∏≤‡∏Å Firebase ‡∏î‡πâ‡∏ß‡∏¢)')) {
    remove(messagesRef).then(() => {
      // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏¢‡∏π‡πà
      const messages = document.querySelectorAll('.message');
      messages.forEach(msg => msg.remove());
      console.log('‚úÖ ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß');
      alert('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
    }).catch((error) => {
      console.error('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ:', error);
      console.error('Error code:', error.code);
      
      if (error.code === 'PERMISSION_DENIED') {
        alert('‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•!\n\n‡πÑ‡∏õ‡∏ó‡∏µ‡πà Firebase Console ‚Üí Rules\n‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô .write ‡πÄ‡∏õ‡πá‡∏ô true');
      } else {
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: ' + error.message);
      }
    });
  }
}

// ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö
window.onload = function() {
  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  createSnowflakes(80);
  createStars(40);
  createGifts(15);
  createBells(12);
  createSparkles(50);
  createConfetti(60);
  createChristmasTrees(8);
  decorateControlBox();
  
  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏•‡∏∏‡∏ó‡∏∏‡∏Å‡πÜ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
  setInterval(createFirework, 3000);
  
  console.log('üî• ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å Firebase...');
  console.log('üéÜ ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡πå‡∏°‡∏≤‡∏™‡πÇ‡∏ó‡∏ô‡πÅ‡∏î‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß!');
  console.log('üéÑ ‡∏ò‡∏µ‡∏°‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡πå‡∏°‡∏≤‡∏™‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏•‡∏≤‡∏™‡∏™‡∏¥‡∏Å!');
  console.log('üéÅ ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß!');
};

// ‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
function decorateControlBox() {
  const control = document.getElementById('control');
  if (!control) return;
  
  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏î‡∏≤‡∏ß‡∏£‡∏≠‡∏ö‡πÜ ‡∏Å‡∏•‡πà‡∏≠‡∏á
  const stars = ['‚≠ê', '‚ú®', 'üåü', 'üí´'];
  const positions = [
    { top: '-25px', left: '20%' },
    { top: '-25px', right: '20%' },
    { bottom: '-25px', left: '30%' },
    { bottom: '-25px', right: '30%' },
    { top: '50%', left: '-35px', transform: 'translateY(-50%)' },
    { top: '50%', right: '-35px', transform: 'translateY(-50%)' }
  ];
  
  positions.forEach((pos, i) => {
    const star = document.createElement('div');
    star.className = 'control-star';
    star.textContent = stars[i % stars.length];
    Object.assign(star.style, pos);
    control.appendChild(star);
  });
  
  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ü‡∏ß‡∏¥‡πâ‡∏á‡∏ß‡∏≤‡∏ß‡∏£‡∏≠‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á
  for (let i = 0; i < 12; i++) {
    const light = document.createElement('div');
    light.className = 'christmas-light';
    const angle = (360 / 12) * i;
    const radius = 180;
    const x = Math.cos(angle * Math.PI / 180) * radius;
    const y = Math.sin(angle * Math.PI / 180) * radius;
    light.style.left = `calc(50% + ${x}px)`;
    light.style.top = `calc(50% + ${y}px)`;
    light.style.animationDelay = (i * 0.1) + 's';
    control.appendChild(light);
  }
}

// ‡∏´‡∏¥‡∏°‡∏∞‡∏ï‡∏Å
function createSnowflakes(count) {
  for (let i = 0; i < count; i++) {
    const flake = document.createElement('div');
    flake.className = 'snowflake';
    const size = Math.random() * 6 + 3;
    flake.style.width = flake.style.height = size + 'px';
    flake.style.left = Math.random() * window.innerWidth + 'px';
    flake.style.animationDuration = (5 + Math.random() * 10) + 's';
    flake.style.animationDelay = Math.random() * 10 + 's';
    document.body.appendChild(flake);
  }
}

// ‡∏î‡∏≤‡∏ß
function createStars(count) {
  for (let i = 0; i < count; i++) {
    const star = document.createElement('div');
    star.className = 'star';
    const size = Math.random() * 15 + 10;
    star.style.width = star.style.height = size + 'px';
    star.style.top = Math.random() * 300 + 'px';
    star.style.left = Math.random() * window.innerWidth + 'px';
    star.style.animationDuration = (1 + Math.random() * 2) + 's';
    star.style.animationDelay = Math.random() * 2 + 's';
    document.body.appendChild(star);
  }
}

// ‡∏û‡∏•‡∏∏/‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡πÑ‡∏ü - ‡πÇ‡∏ó‡∏ô‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡πå‡∏°‡∏≤‡∏™
function createFirework() {
  const colors = ['#ff0000', '#ffd700', '#228b22', '#ffffff', '#dc143c', '#ffeb3b', '#c41e3a'];
  const x = Math.random() * window.innerWidth;
  const y = Math.random() * window.innerHeight * 0.5;
  
  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏ô‡∏∏‡∏†‡∏≤‡∏Ñ‡∏û‡∏•‡∏∏ 30 ‡∏≠‡∏ô‡∏∏‡∏†‡∏≤‡∏Ñ
  for (let i = 0; i < 30; i++) {
    const particle = document.createElement('div');
    particle.className = 'firework';
    particle.style.left = x + 'px';
    particle.style.top = y + 'px';
    particle.style.background = colors[Math.floor(Math.random() * colors.length)];
    
    const angle = (Math.PI * 2 * i) / 30;
    const velocity = 50 + Math.random() * 100;
    const tx = Math.cos(angle) * velocity;
    const ty = Math.sin(angle) * velocity;
    
    particle.style.setProperty('--tx', tx + 'px');
    particle.style.setProperty('--ty', ty + 'px');
    particle.style.boxShadow = `0 0 10px ${particle.style.background}`;
    
    document.body.appendChild(particle);
    
    setTimeout(() => particle.remove(), 2000);
  }
}

// ‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏ï‡∏ï‡∏µ‡πâ - ‡πÇ‡∏ó‡∏ô‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡πå‡∏°‡∏≤‡∏™
function createConfetti(count) {
  const colors = ['#ff0000', '#228b22', '#ffd700', '#ffffff', '#c41e3a', '#006400'];
  const shapes = ['circle', 'square', 'rectangle'];
  
  for (let i = 0; i < count; i++) {
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    confetti.style.left = Math.random() * window.innerWidth + 'px';
    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
    confetti.style.animationDuration = (3 + Math.random() * 4) + 's';
    confetti.style.animationDelay = Math.random() * 5 + 's';
    
    const shape = shapes[Math.floor(Math.random() * shapes.length)];
    if (shape === 'circle') {
      confetti.style.borderRadius = '50%';
    } else if (shape === 'rectangle') {
      confetti.style.width = '15px';
      confetti.style.height = '8px';
    }
    
    document.body.appendChild(confetti);
  }
}

// ‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç
function createGifts(count) {
  for (let i = 0; i < count; i++) {
    const gift = document.createElement('div');
    gift.className = 'gift';
    gift.style.left = Math.random() * window.innerWidth + 'px';
    gift.style.animationDuration = (8 + Math.random() * 6) + 's';
    gift.style.animationDelay = Math.random() * 8 + 's';
    
    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏¥‡∏ö‡∏ö‡∏¥‡πâ‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
    gift.innerHTML = '<div style="position:absolute;top:-3px;left:50%;transform:translateX(-50%);width:5px;height:36px;background:#ffd700;"></div>';
    
    document.body.appendChild(gift);
  }
}

// ‡∏£‡∏∞‡∏Ü‡∏±‡∏á
function createBells(count) {
  for (let i = 0; i < count; i++) {
    const bell = document.createElement('div');
    bell.className = 'bell';
    bell.style.top = Math.random() * 200 + 'px';
    bell.style.left = Math.random() * window.innerWidth + 'px';
    bell.style.animationDelay = Math.random() * 3 + 's';
    document.body.appendChild(bell);
  }
}

// Sparkles
function createSparkles(count) {
  for (let i = 0; i < count; i++) {
    const sparkle = document.createElement('div');
    sparkle.className = 'sparkle';
    sparkle.style.top = Math.random() * window.innerHeight + 'px';
    sparkle.style.left = Math.random() * window.innerWidth + 'px';
    sparkle.style.animationDelay = Math.random() * 1.5 + 's';
    document.body.appendChild(sparkle);
  }
}

// ‡∏ï‡πâ‡∏ô‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡πå‡∏°‡∏≤‡∏™
function createChristmasTrees(count) {
  for (let i = 0; i < count; i++) {
    const tree = document.createElement('div');
    tree.className = 'christmas-tree';
    tree.style.left = (i * (100 / count) + Math.random() * 5) + '%';
    
    tree.innerHTML = `
      <div class="tree-star"></div>
      <div class="tree-top"></div>
      <div class="tree-middle"></div>
      <div class="tree-trunk"></div>
    `;
    
    document.body.appendChild(tree);
  }
}
</script>

</body>
</html>
